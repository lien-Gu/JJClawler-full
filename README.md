# JJClawler - æ™‹æ±Ÿæ–‡å­¦åŸçˆ¬è™«é¡¹ç›®

## é¡¹ç›®æ¦‚è¿°

JJClawler æ˜¯ä¸€ä¸ªä¸“ä¸ºæ™‹æ±Ÿæ–‡å­¦åŸå¼€å‘çš„æ•°æ®çˆ¬è™«é¡¹ç›®ï¼ŒåŒ…å«å®Œæ•´çš„åç«¯æ•°æ®é‡‡é›†æœåŠ¡å’Œå¾®ä¿¡å°ç¨‹åºå‰ç«¯ç•Œé¢ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼Œæä¾›ç¨³å®šã€é«˜æ•ˆçš„æ•°æ®çˆ¬å–å’Œå±•ç¤ºæœåŠ¡ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ•·ï¸ **è‡ªåŠ¨åŒ–çˆ¬è™«**: å®šæ—¶çˆ¬å–æ¦œå•æ•°æ®å’Œå°è¯´ä¿¡æ¯
- ğŸ“Š **æ•°æ®åˆ†æ**: ä¹¦ç±ç‚¹å‡»é‡ã€æ”¶è—é‡è¶‹åŠ¿åˆ†æ
- ğŸ“± **å°ç¨‹åºç•Œé¢**: ç›´è§‚çš„æ•°æ®å±•ç¤ºå’Œæ£€ç´¢åŠŸèƒ½
- ğŸ”„ **å®æ—¶æ›´æ–°**: æ”¯æŒæ‰‹åŠ¨è§¦å‘å’Œå®šæ—¶è‡ªåŠ¨æ›´æ–°
- ğŸ“ˆ **å†å²è¿½è¸ª**: å®Œæ•´çš„æ’åå˜åŒ–å’Œæ•°æ®è¶‹åŠ¿è®°å½•

## é¡¹ç›®ç»“æ„

```
JJClawler-full/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡ (Python FastAPI)
â”‚   â”œâ”€â”€ app/                    # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ modules/           # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ data/                  # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”‚   â””â”€â”€ tests/                 # æµ‹è¯•ä»£ç 
â”œâ”€â”€ frontend/                  # å‰ç«¯å°ç¨‹åº (WeChat Mini-Program)
â”‚   â”œâ”€â”€ pages/                 # å°ç¨‹åºé¡µé¢
â”‚   â”œâ”€â”€ components/            # ç»„ä»¶åº“
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ styles/                # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â””â”€â”€ CLAUDE.md                  # å¼€å‘æŒ‡å—
```

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **æ¡†æ¶**: FastAPI (Python 3.13+)
- **æ•°æ®åº“**: SQLite with SQLModel ORM
- **çˆ¬è™«**: httpx + Beautiful Soup
- **è°ƒåº¦**: APScheduler
- **éƒ¨ç½²**: Docker + Poetry

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: WeChat Mini-Program
- **UI**: Vue.js è¯­æ³•
- **æ ·å¼**: SCSS
- **çŠ¶æ€ç®¡ç†**: æœ¬åœ°å­˜å‚¨ + API è°ƒç”¨

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.13+
- Poetry (æ¨è)
- å¾®ä¿¡å¼€å‘è€…å·¥å…·
- Git

### åç«¯éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/lien-Gu/JJClawler-full.git
cd JJClawler-full/backend
```

2. **å®‰è£…ä¾èµ–**
```bash
poetry install
poetry shell
```

3. **å¯åŠ¨æœåŠ¡**
```bash
poetry run uvicorn app.main:app --reload --port 8000
```

4. **éªŒè¯éƒ¨ç½²**
```bash
curl http://localhost:8000/health
# è®¿é—® API æ–‡æ¡£: http://localhost:8000/docs
```

5. **åœæ­¢æœåŠ¡**
```bash
# æ–¹æ³•1: åœ¨è¿è¡Œuvicornçš„ç»ˆç«¯ä¸­æŒ‰ Ctrl+C
# æ–¹æ³•2: æŸ¥æ‰¾å¹¶æ€æ­»è¿›ç¨‹
ps aux | grep uvicorn
kill <è¿›ç¨‹ID>

# æ–¹æ³•3: å¼ºåˆ¶æ€æ­»æ‰€æœ‰uvicornè¿›ç¨‹
pkill -f uvicorn

# æ–¹æ³•4: æ€æ­»å ç”¨8000ç«¯å£çš„è¿›ç¨‹
lsof -i :8000
kill -9 <PID>
```

### å‰ç«¯éƒ¨ç½²

1. **å¯¼å…¥é¡¹ç›®**
   - æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
   - å¯¼å…¥ `frontend/` ç›®å½•ä½œä¸ºå°ç¨‹åºé¡¹ç›®

2. **é…ç½®åç«¯åœ°å€**
   - ç¼–è¾‘ `frontend/utils/request.js` ä¸­çš„ `baseURL`
   - å¼€å‘ç¯å¢ƒ: `http://localhost:8000/api/v1`

3. **é¢„è§ˆè¿è¡Œ**
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç¼–è¯‘é¢„è§ˆ

## API æ¥å£è¯´æ˜

### æ ¸å¿ƒæ¥å£

| æ¥å£åˆ†ç±» | ç«¯ç‚¹ | æè¿° |
|---------|------|------|
| **ç»Ÿè®¡æ•°æ®** | `GET /api/v1/stats/overview` | é¦–é¡µç»Ÿè®¡æ¦‚è§ˆ |
| **æ¦œå•æ•°æ®** | `GET /api/v1/rankings` | æ¦œå•åˆ—è¡¨ |
| | `GET /api/v1/rankings/hot` | çƒ­é—¨æ¦œå• |
| | `GET /api/v1/rankings/{id}/books` | æ¦œå•ä¹¦ç±åˆ—è¡¨ |
| **ä¹¦ç±æ•°æ®** | `GET /api/v1/books/{id}` | ä¹¦ç±è¯¦æƒ… |
| | `GET /api/v1/books/{id}/rankings` | ä¹¦ç±æ’åå†å² |
| | `GET /api/v1/books/{id}/trends` | ä¹¦ç±è¶‹åŠ¿æ•°æ® |
| **çˆ¬è™«ç®¡ç†** | `POST /api/v1/crawl/jiazi` | è§¦å‘å¤¹å­æ¦œçˆ¬å– |
| | `GET /api/v1/crawl/tasks` | æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ |
| **é¡µé¢é…ç½®** | `GET /api/v1/pages` | è·å–é¡µé¢é…ç½® |

### æ¥å£ç»Ÿä¸€
ç»è¿‡åˆ†æå’Œä¼˜åŒ–ï¼Œå‰åç«¯æ¥å£å·²å®Œå…¨ç»Ÿä¸€ï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ•°æ®æ ¼å¼æ ‡å‡†åŒ–
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… åˆ†é¡µå‚æ•°ç»Ÿä¸€
- âœ… å“åº”ç»“æ„ä¸€è‡´

## éƒ¨ç½²è¯´æ˜

### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **æ„å»ºé•œåƒ**
```bash
cd backend
docker build -t jjcrawler:latest .
```

2. **è¿è¡Œå®¹å™¨**
```bash
docker run -d \
  --name jjcrawler \
  -p 8000:8000 \
  -v $(pwd)/data:/app/data \
  jjcrawler:latest
```

3. **é…ç½®åå‘ä»£ç†**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

è¯¦ç»†çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—è¯·å‚è€ƒï¼š
- [Docker éƒ¨ç½²æ–‡æ¡£](backend/docs/docker-deployment.md)
- [ç”Ÿäº§è¿ç»´æŒ‡å—](backend/docs/production-operations.md)
- [è°ƒåº¦å™¨è¿ç»´æŒ‡å—](backend/docs/scheduler-operations.md)

## å®šæ—¶ä»»åŠ¡è¯´æ˜

### è‡ªåŠ¨è°ƒåº¦ç­–ç•¥
- **å¤¹å­æ¦œ**: æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡ (é«˜é¢‘æ¦œå•)
- **åˆ†ç±»æ¦œå•**: æ¯å¤©æ›´æ–°ä¸€æ¬¡ (ä¸Šåˆ6ç‚¹åˆ°ä¸‹åˆ6ç‚¹åˆ†æ•£æ‰§è¡Œ)
- **é”™è¯¯é‡è¯•**: æŒ‡æ•°é€€é¿ç®—æ³•ï¼Œæœ€å¤šé‡è¯•3æ¬¡
- **é™æµæœºåˆ¶**: è¯·æ±‚é—´éš”1ç§’ï¼Œé¿å…å¯¹ç›®æ ‡ç«™ç‚¹é€ æˆå‹åŠ›

### æ‰‹åŠ¨ç®¡ç†
```bash
# æŸ¥çœ‹è°ƒåº¦å™¨çŠ¶æ€
curl http://localhost:8000/api/v1/crawl/scheduler/status

# æ‰‹åŠ¨è§¦å‘å¤¹å­æ¦œçˆ¬å–
curl -X POST http://localhost:8000/api/v1/crawl/jiazi

# æŸ¥çœ‹ä»»åŠ¡å†å²
curl http://localhost:8000/api/v1/crawl/tasks
```

### ä»»åŠ¡ç›‘æ§
- å®æ—¶ä»»åŠ¡çŠ¶æ€æŸ¥çœ‹
- ä»»åŠ¡æ‰§è¡Œå†å²è®°å½•
- å¼‚å¸¸å‘Šè­¦å’Œè‡ªåŠ¨æ¢å¤
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

## å¼€å‘æŒ‡å—

### åç«¯å¼€å‘
```bash
# æ ¼å¼åŒ–ä»£ç 
poetry run black .
poetry run isort .

# è¿è¡Œæµ‹è¯•
poetry run pytest

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
poetry run uvicorn app.main:app --reload
```

### å‰ç«¯å¼€å‘
- ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·è¿›è¡Œå¼€å‘
- éµå¾ªå¾®ä¿¡å°ç¨‹åºå¼€å‘è§„èŒƒ
- ç»„ä»¶åŒ–å¼€å‘ï¼Œæé«˜ä»£ç é‡ç”¨æ€§

### API æµ‹è¯•
- ä½¿ç”¨ `backend/test_main.http` è¿›è¡Œæ¥å£æµ‹è¯•
- è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹äº¤äº’å¼æ–‡æ¡£

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨
```sql
-- ä¹¦ç±åŸºç¡€ä¿¡æ¯
books: book_id, title, author_id, author_name, novel_class, tags

-- ä¹¦ç±åŠ¨æ€æ•°æ®å¿«ç…§
book_snapshots: book_id, total_clicks, total_favorites, snapshot_time

-- æ¦œå•æ’åå¿«ç…§
ranking_snapshots: ranking_id, book_id, position, snapshot_time

-- æ¦œå•é…ç½®
rankings: ranking_id, name, channel, frequency, update_interval
```

### è®¾è®¡ç‰¹ç‚¹
- **é™æ€ä¸åŠ¨æ€åˆ†ç¦»**: åŸºç¡€ä¿¡æ¯ä¸ç»Ÿè®¡æ•°æ®åˆ†è¡¨å­˜å‚¨
- **æ—¶é—´åºåˆ—è®¾è®¡**: æ”¯æŒè¶‹åŠ¿åˆ†æå’Œå†å²æŸ¥è¯¢
- **æ··åˆå­˜å‚¨**: æ•°æ®åº“ + JSON æ–‡ä»¶ï¼Œå„å¸å…¶èŒ
- **æ€§èƒ½ä¼˜åŒ–**: SQLite WAL æ¨¡å¼ï¼Œå¤åˆç´¢å¼•

## ç›‘æ§ä¸è¿ç»´

### å¥åº·æ£€æŸ¥
```bash
# ç³»ç»Ÿå¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æ•°æ®åº“çŠ¶æ€
curl http://localhost:8000/stats

# è°ƒåº¦å™¨çŠ¶æ€
curl http://localhost:8000/api/v1/crawl/scheduler/status
```

### æ—¥å¿—ç®¡ç†
- ç»“æ„åŒ–æ—¥å¿—è®°å½•
- é”™è¯¯ç­‰çº§åˆ†ç±»
- æ—¥å¿—è½®è½¬å’Œå½’æ¡£
- å®æ—¶æ—¥å¿—ç›‘æ§

### æ•°æ®å¤‡ä»½
```bash
# æ•°æ®åº“å¤‡ä»½
cp data/*.db backup/

# é…ç½®æ–‡ä»¶å¤‡ä»½
cp data/urls.json backup/
cp data/tasks/*.json backup/
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8000
# ä½¿ç”¨å…¶ä»–ç«¯å£
uvicorn app.main:app --reload --port 8001
```

**Q: çˆ¬è™«ä»»åŠ¡å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**
```bash
# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
curl http://localhost:8000/api/v1/crawl/tasks
# æ‰‹åŠ¨é‡è¯•
curl -X POST http://localhost:8000/api/v1/crawl/jiazi
```

**Q: æ•°æ®åº“é”å®šæ€ä¹ˆåŠï¼Ÿ**
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
# ç¡®ä¿ WAL æ¨¡å¼å¯ç”¨
# é‡å¯åº”ç”¨æœåŠ¡
```

## è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ
- Python: éµå¾ª PEP 8 è§„èŒƒ
- å‰ç«¯: éµå¾ªå¾®ä¿¡å°ç¨‹åºå¼€å‘è§„èŒƒ
- æäº¤ä¿¡æ¯: ä½¿ç”¨æ¸…æ™°çš„æè¿°æ€§æ¶ˆæ¯
- æ–‡æ¡£: æ›´æ–°ç›¸å…³æ–‡æ¡£

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

- **é¡¹ç›®è´Ÿè´£äºº**: Lien Gu
- **é‚®ç®±**: guliyu0216@163.com
- **é¡¹ç›®åœ°å€**: https://github.com/lien-Gu/JJClawler-full

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-06-23)
- âœ… å®Œæˆåç«¯ API æ¥å£ç»Ÿä¸€
- âœ… å‰ç«¯å°ç¨‹åºç•Œé¢å®Œæˆ
- âœ… Docker éƒ¨ç½²æ–¹æ¡ˆ
- âœ… å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
- âœ… å®Œæ•´çš„ç›‘æ§å’Œè¿ç»´æ–¹æ¡ˆ

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œç½‘ç«™ä½¿ç”¨æ¡æ¬¾ã€‚