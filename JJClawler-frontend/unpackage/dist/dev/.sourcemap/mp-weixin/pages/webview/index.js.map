{"version":3,"file":"index.js","sources":["pages/webview/index.vue","pages/webview/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"webview-page\">\n    <!-- 自定义导航栏 -->\n    <view class=\"custom-navbar\">\n      <view class=\"navbar-content\">\n        <view class=\"back-btn\" @tap=\"goBack\">\n          <text class=\"back-icon\">←</text>\n        </view>\n        <text class=\"navbar-title\">{{ pageTitle }}</text>\n        <view class=\"placeholder\"></view>\n      </view>\n    </view>\n    \n    <!-- 内容区域 -->\n    <view class=\"content-area\">\n      <!-- 加载状态 -->\n      <view v-if=\"loading\" class=\"loading-container\">\n        <view class=\"loading-spinner\"></view>\n        <text class=\"loading-text\">正在加载...</text>\n      </view>\n      \n      <!-- 错误状态 -->\n      <view v-else-if=\"error\" class=\"error-container\">\n        <text class=\"error-icon\">⚠️</text>\n        <text class=\"error-title\">加载失败</text>\n        <text class=\"error-message\">{{ error }}</text>\n        <view class=\"retry-btn\" @tap=\"retryLoad\">\n          <text class=\"retry-text\">重试</text>\n        </view>\n      </view>\n      \n      <!-- 内容显示 -->\n      <view v-else class=\"content-container\">\n        <!-- H5环境使用iframe -->\n        <view v-if=\"isH5\" class=\"iframe-container\">\n          <iframe :src=\"targetUrl\" class=\"content-iframe\"></iframe>\n        </view>\n        \n        <!-- 小程序环境使用web-view -->\n        <web-view v-else-if=\"isMiniProgram\" :src=\"targetUrl\" @message=\"onWebViewMessage\"></web-view>\n        \n        <!-- APP环境或其他情况显示提示 -->\n        <view v-else class=\"fallback-container\">\n          <text class=\"fallback-title\">即将跳转</text>\n          <text class=\"fallback-url\">{{ targetUrl }}</text>\n          <view class=\"open-btn\" @tap=\"openInBrowser\">\n            <text class=\"open-text\">在浏览器中打开</text>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n/**\n * WebView页面\n * @description 用于显示外部链接内容，支持多平台\n */\nexport default {\n  name: 'WebViewPage',\n  \n  data() {\n    return {\n      targetUrl: '',\n      pageTitle: '加载中...',\n      loading: true,\n      error: '',\n      \n      // 平台检测\n      isH5: false,\n      isMiniProgram: false,\n      isApp: false\n    }\n  },\n  \n  onLoad(options) {\n    // 检测平台\n    this.detectPlatform()\n    \n    // 获取URL参数\n    if (options.url) {\n      this.targetUrl = decodeURIComponent(options.url)\n    }\n    \n    if (options.title) {\n      this.pageTitle = decodeURIComponent(options.title)\n    }\n    \n    // 开始加载\n    this.loadContent()\n  },\n  \n  methods: {\n    /**\n     * 检测当前平台\n     */\n    detectPlatform() {\n      // #ifdef H5\n      this.isH5 = true\n      // #endif\n      \n      // #ifdef MP-WEIXIN\n      this.isMiniProgram = true\n      // #endif\n      \n      // #ifdef APP-PLUS\n      this.isApp = true\n      // #endif\n    },\n    \n    /**\n     * 加载内容\n     */\n    async loadContent() {\n      if (!this.targetUrl) {\n        this.error = '缺少URL参数'\n        this.loading = false\n        return\n      }\n      \n      try {\n        this.loading = true\n        this.error = ''\n        \n        // 模拟加载延迟\n        await new Promise(resolve => setTimeout(resolve, 1000))\n        \n        // 根据平台处理URL\n        await this.handleUrlByPlatform()\n        \n        this.loading = false\n      } catch (err) {\n        console.error('加载内容失败:', err)\n        this.error = err.message || '加载失败'\n        this.loading = false\n      }\n    },\n    \n    /**\n     * 根据平台处理URL\n     */\n    async handleUrlByPlatform() {\n      if (this.isH5) {\n        // H5环境直接使用iframe\n        console.log('H5环境，使用iframe加载:', this.targetUrl)\n      } else if (this.isMiniProgram) {\n        // 小程序环境使用web-view\n        console.log('小程序环境，使用web-view加载:', this.targetUrl)\n        \n        // 检查URL是否在小程序业务域名白名单中\n        if (!this.isValidMiniProgramUrl(this.targetUrl)) {\n          throw new Error('URL不在小程序业务域名白名单中')\n        }\n      } else if (this.isApp) {\n        // APP环境使用系统浏览器\n        console.log('APP环境，准备在系统浏览器中打开:', this.targetUrl)\n      }\n    },\n    \n    /**\n     * 检查URL是否适用于小程序\n     */\n    isValidMiniProgramUrl(url) {\n      // 这里应该检查URL是否在小程序的业务域名白名单中\n      // 暂时返回true，实际项目中需要根据具体配置判断\n      return true\n    },\n    \n    /**\n     * 重试加载\n     */\n    retryLoad() {\n      this.loadContent()\n    },\n    \n    /**\n     * 返回上一页\n     */\n    goBack() {\n      uni.navigateBack({\n        fail: () => {\n          // 如果无法返回，则跳转到首页\n          uni.switchTab({\n            url: '/pages/index/index'\n          })\n        }\n      })\n    },\n    \n    /**\n     * 在浏览器中打开\n     */\n    openInBrowser() {\n      // #ifdef APP-PLUS\n      plus.runtime.openURL(this.targetUrl)\n      // #endif\n      \n      // #ifdef H5\n      window.open(this.targetUrl, '_blank')\n      // #endif\n      \n      // #ifdef MP-WEIXIN\n      uni.showModal({\n        title: '提示',\n        content: '请复制链接到浏览器中打开',\n        showCancel: true,\n        cancelText: '取消',\n        confirmText: '复制链接',\n        success: (res) => {\n          if (res.confirm) {\n            uni.setClipboardData({\n              data: this.targetUrl,\n              success: () => {\n                uni.showToast({\n                  title: '链接已复制',\n                  icon: 'success'\n                })\n              }\n            })\n          }\n        }\n      })\n      // #endif\n    },\n    \n    /**\n     * Web-view消息处理\n     */\n    onWebViewMessage(event) {\n      console.log('收到web-view消息:', event.detail.data)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.webview-page {\n  height: 100vh;\n  background-color: #f4f0eb;\n  display: flex;\n  flex-direction: column;\n}\n\n.custom-navbar {\n  background-color: #ffffff;\n  border-bottom: 1rpx solid #e0e0e0;\n  \n  .navbar-content {\n    display: flex;\n    align-items: center;\n    height: 88rpx;\n    padding: 0 32rpx;\n    padding-top: var(--status-bar-height, 0);\n    \n    .back-btn {\n      width: 80rpx;\n      height: 60rpx;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      \n      .back-icon {\n        font-size: 36rpx;\n        color: #333333;\n      }\n      \n      &:active {\n        opacity: 0.6;\n      }\n    }\n    \n    .navbar-title {\n      flex: 1;\n      text-align: center;\n      font-size: 32rpx;\n      font-weight: 500;\n      color: #333333;\n      margin: 0 20rpx;\n      \n      /* 文字溢出处理 */\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n    }\n    \n    .placeholder {\n      width: 80rpx;\n    }\n  }\n}\n\n.content-area {\n  flex: 1;\n  position: relative;\n}\n\n.loading-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  \n  .loading-spinner {\n    width: 60rpx;\n    height: 60rpx;\n    border: 4rpx solid #e0e0e0;\n    border-top: 4rpx solid #64a347;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin-bottom: 32rpx;\n  }\n  \n  .loading-text {\n    font-size: 28rpx;\n    color: #666666;\n  }\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.error-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  padding: 64rpx;\n  \n  .error-icon {\n    font-size: 120rpx;\n    margin-bottom: 32rpx;\n  }\n  \n  .error-title {\n    font-size: 36rpx;\n    font-weight: 500;\n    color: #333333;\n    margin-bottom: 16rpx;\n  }\n  \n  .error-message {\n    font-size: 28rpx;\n    color: #666666;\n    text-align: center;\n    margin-bottom: 64rpx;\n    line-height: 1.5;\n  }\n  \n  .retry-btn {\n    background-color: #64a347;\n    border-radius: 32rpx;\n    padding: 24rpx 48rpx;\n    \n    .retry-text {\n      font-size: 32rpx;\n      color: #ffffff;\n      font-weight: 500;\n    }\n    \n    &:active {\n      opacity: 0.8;\n    }\n  }\n}\n\n.content-container {\n  height: 100%;\n}\n\n.iframe-container {\n  height: 100%;\n  \n  .content-iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n  }\n}\n\n.fallback-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  padding: 64rpx;\n  \n  .fallback-title {\n    font-size: 36rpx;\n    font-weight: 500;\n    color: #333333;\n    margin-bottom: 32rpx;\n  }\n  \n  .fallback-url {\n    font-size: 24rpx;\n    color: #666666;\n    text-align: center;\n    margin-bottom: 64rpx;\n    word-break: break-all;\n    line-height: 1.5;\n  }\n  \n  .open-btn {\n    background-color: #64a347;\n    border-radius: 32rpx;\n    padding: 24rpx 48rpx;\n    \n    .open-text {\n      font-size: 32rpx;\n      color: #ffffff;\n      font-weight: 500;\n    }\n    \n    &:active {\n      opacity: 0.8;\n    }\n  }\n}\n</style> ","import MiniProgramPage from '/Users/guliyu/weixin-miniapp/JJClawler-frontend/JJClawler-frontend/pages/webview/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AA2DA,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EAEN,OAAO;AACL,WAAO;AAAA,MACL,WAAW;AAAA,MACX,WAAW;AAAA,MACX,SAAS;AAAA,MACT,OAAO;AAAA;AAAA,MAGP,MAAM;AAAA,MACN,eAAe;AAAA,MACf,OAAO;AAAA,IACT;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AAEd,SAAK,eAAe;AAGpB,QAAI,QAAQ,KAAK;AACf,WAAK,YAAY,mBAAmB,QAAQ,GAAG;AAAA,IACjD;AAEA,QAAI,QAAQ,OAAO;AACjB,WAAK,YAAY,mBAAmB,QAAQ,KAAK;AAAA,IACnD;AAGA,SAAK,YAAY;AAAA,EAClB;AAAA,EAED,SAAS;AAAA;AAAA;AAAA;AAAA,IAIP,iBAAiB;AAMf,WAAK,gBAAgB;AAAA,IAMtB;AAAA;AAAA;AAAA;AAAA,IAKD,MAAM,cAAc;AAClB,UAAI,CAAC,KAAK,WAAW;AACnB,aAAK,QAAQ;AACb,aAAK,UAAU;AACf;AAAA,MACF;AAEA,UAAI;AACF,aAAK,UAAU;AACf,aAAK,QAAQ;AAGb,cAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,GAAI,CAAC;AAGtD,cAAM,KAAK,oBAAoB;AAE/B,aAAK,UAAU;AAAA,MACf,SAAO,KAAK;AACZA,sBAAAA,MAAc,MAAA,SAAA,kCAAA,WAAW,GAAG;AAC5B,aAAK,QAAQ,IAAI,WAAW;AAC5B,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA;AAAA;AAAA;AAAA,IAKD,MAAM,sBAAsB;AAC1B,UAAI,KAAK,MAAM;AAEbA,sBAAY,MAAA,MAAA,OAAA,kCAAA,oBAAoB,KAAK,SAAS;AAAA,iBACrC,KAAK,eAAe;AAE7BA,2EAAY,uBAAuB,KAAK,SAAS;AAGjD,YAAI,CAAC,KAAK,sBAAsB,KAAK,SAAS,GAAG;AAC/C,gBAAM,IAAI,MAAM,kBAAkB;AAAA,QACpC;AAAA,MACF,WAAW,KAAK,OAAO;AAErBA,2EAAY,sBAAsB,KAAK,SAAS;AAAA,MAClD;AAAA,IACD;AAAA;AAAA;AAAA;AAAA,IAKD,sBAAsB,KAAK;AAGzB,aAAO;AAAA,IACR;AAAA;AAAA;AAAA;AAAA,IAKD,YAAY;AACV,WAAK,YAAY;AAAA,IAClB;AAAA;AAAA;AAAA;AAAA,IAKD,SAAS;AACPA,oBAAAA,MAAI,aAAa;AAAA,QACf,MAAM,MAAM;AAEVA,wBAAAA,MAAI,UAAU;AAAA,YACZ,KAAK;AAAA,WACN;AAAA,QACH;AAAA,OACD;AAAA,IACF;AAAA;AAAA;AAAA;AAAA,IAKD,gBAAgB;AAUdA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,aAAa;AAAA,QACb,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACfA,0BAAAA,MAAI,iBAAiB;AAAA,cACnB,MAAM,KAAK;AAAA,cACX,SAAS,MAAM;AACbA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,iBACP;AAAA,cACH;AAAA,aACD;AAAA,UACH;AAAA,QACF;AAAA,OACD;AAAA,IAEF;AAAA;AAAA;AAAA;AAAA,IAKD,iBAAiB,OAAO;AACtBA,oBAAA,MAAA,MAAA,OAAA,kCAAY,iBAAiB,MAAM,OAAO,IAAI;AAAA,IAChD;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;ACxOA,GAAG,WAAW,eAAe;"}